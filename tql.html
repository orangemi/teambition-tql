<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Teambition TQL</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/teambition-tql/assets/css/3.styles.512d33b6.css" as="style"><link rel="preload" href="/teambition-tql/assets/js/app.8630efd5.js" as="script"><link rel="preload" href="/teambition-tql/assets/js/0.ca55fbad.js" as="script"><link rel="prefetch" href="/teambition-tql/assets/js/1.dc956c79.js"><link rel="prefetch" href="/teambition-tql/assets/js/2.443f8556.js">
    <link rel="stylesheet" href="/teambition-tql/assets/css/3.styles.512d33b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/teambition-tql/" class="home-link router-link-active"><!----><span class="site-name">
      Teambition TQL
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><!----></div><div class="page"><div class="content"><h1 id="teambition-query-laguage"><a href="#teambition-query-laguage" aria-hidden="true" class="header-anchor">#</a> Teambition Query Laguage</h1><h2 id="summary-简介"><a href="#summary-简介" aria-hidden="true" class="header-anchor">#</a> Summary 简介</h2><p>TQL是一种<code>搜索DSL</code>(Domain Specific Language). 用于简化搜索语句，扩大搜索场景的基础工程。
是基于<a href="https://zh.wikipedia.org/wiki/SQL" target="_blank" rel="noopener noreferrer">SQL</a>, 参考<a href="https://confluence.atlassian.com/jiracore/blog/2015/07/search-jira-like-a-boss-with-jql" target="_blank" rel="noopener noreferrer">JQL</a>, 取SQL的部分条件语句语法(WHERE condition)，以及聚合语句语法(GROUP BY groupElment), 排序语句语法(ORDER BY orderElement), 并优化部分内容，创造出来的查询语句。</p><h2 id="如何写tql"><a href="#如何写tql" aria-hidden="true" class="header-anchor">#</a> 如何写TQL</h2><p>详见 Thoughts 文档 <a href="https://thoughts.teambition.com/workspaces/5ae456381cb236e769050120/docs/5a38b234aa4a210001927f59" target="_blank" rel="noopener noreferrer">Search-Lab 101</a></p><h2 id="example-案例"><a href="#example-案例" aria-hidden="true" class="header-anchor">#</a> Example 案例</h2><pre class="language-text"><code># 空查询也是允许的
dueDate &lt; 7d # 一周内截止的任务
dueDate &lt; 7d AND executorId = currentUser() # 一周内截止的我的任务
text ~ 任务 # 查询含有‘任务’关键词的任务
c:数字字段 &gt; 0 # 查询某一个数字字段大于0的任务
c:59e98ee5ecaa69324136c8e2 &gt; 0 # 查询某一个数字字段大于0的任务
c:数字字段 &gt; 0 AND isDone = true
projectId = 58d8ca99816927c3a051dfcf
projectId = 58d8ca99816927c3a051dfcf GROUP BY executorId
GROUP BY executorId
GROUP SUM(storyPoint) BY executorId
GROUP SUM(storyPoint) BY executorId,projectId
</code></pre><h2 id="设计目标"><a href="#设计目标" aria-hidden="true" class="header-anchor">#</a> 设计目标</h2><p>用户可以自定义过滤器，对任务／日程／文章进行过滤，甚至是分类聚合计数／求值。
目标用户：开发人员，设计师，项目经理，测试人员。目前这个TQL对普通用户还有一定门槛，但通过自动补充，弹出可选项等功能，能使大部分用户对其无明显痛感。</p><h2 id="表达式-tql-specification"><a href="#表达式-tql-specification" aria-hidden="true" class="header-anchor">#</a> 表达式 TQL Specification</h2><p>TQL由<code>条件表达式</code>和<code>聚合表达式</code>以及<code>排序表达式</code>组合, 可以是空的, 表达式如下：</p><pre class="language-text"><code>[conditionExpr] [groupExpr] [orderExpr]
</code></pre><h3 id="comment-注释"><a href="#comment-注释" aria-hidden="true" class="header-anchor">#</a> Comment 注释</h3><p>行内注释，从<code>#</code>开始到行结尾，都是算注释。注释代码不参与执行。</p><h3 id="conditionexpr-条件表达式"><a href="#conditionexpr-条件表达式" aria-hidden="true" class="header-anchor">#</a> conditionExpr 条件表达式</h3><p>可以由以下任意一种格式表达(此处字段表达式仍需要优化，尽量缩短简明表达字段含义)：</p><ul><li>field operation value</li><li>conditionExpr AND|OR conditionExpr</li><li>(conditionExpr)</li></ul><h3 id="field-字段"><a href="#field-字段" aria-hidden="true" class="header-anchor">#</a> field 字段</h3><p>可以由以下任意一种格式表达：</p><ul><li>固定字段：
<ul><li>text: 只能用于<code>~</code>语句, 在搜索Task时等价于 (title ~ XX OR content ~ XX OR activityContent ~ XX)</li><li>字段根据搜索类型不同而不同，详见<a href="/teambition-tql/fields.html">fields</a></li></ul></li><li>自定义字段：
<ul><li>cf:自定义名</li><li>cf:自定义字段ID</li><li><s>ccf:计算字段名</s></li><li><s>ccf:计算字段ID</s></li></ul></li></ul><h3 id="operation-操作符"><a href="#operation-操作符" aria-hidden="true" class="header-anchor">#</a> operation 操作符</h3><ul><li><code>(&gt;|&gt;=|&lt;|&lt;=|=|!=)</code> 分别表示大于, 大于等于, 小于, 小于等于, 等于 和 不等于。</li><li><code>~</code> 表示 LIKE 近似搜索，用于全文搜索。</li><li><s>[not ] between 右侧只能是numberRange 或 dateRange</s></li><li><code>[NOT] IN</code>: 表示是否在一个集合中</li><li><code>[NOT] CONTAIN</code>: 表示是否含有某一个值</li></ul><h3 id="value-值"><a href="#value-值" aria-hidden="true" class="header-anchor">#</a> value 值</h3><ul><li>null: <code>null</code>: 表示此字段无值，只能是<code>=</code>或者<code>!=</code>, 对所有字段都有效，判定字段是否有值, 例如: <code>dueDate = null</code>表示没有dueDate的任务</li><li>word: <code>[^symbol]+</code> 非保留符号组成的word, 可以直接视为string或number值</li><li>string: <code>['|&quot;]{character+}['|&quot;]</code> 字符串, 任何非保留字, 或者以成对的引号引用的值. 如果中间需要出现单引号则需要用反斜杠 <code>\</code> escape.</li><li>function: <code>word([value[, value [, ...] ]])</code> 函数, 详见函数</li><li>number: <code>[-](0|1-9[0-9...])[.0-9...]</code> 数字</li><li>dateOffset: <code>number(d|day|m|month|y|year|h|hour|min|minute|s|second)</code> 表示时间断</li><li>date: <code>dateOffset|ISO8601_TIME_FORMAT</code> 相对当前时间或者绝对时间 eg.<code>2017-01-02T01:23:45:000+8:00</code>, <code>-7d</code></li><li>rangeValue: <code>(value [, ...])</code> 数据集合</li></ul><h3 id="string-双引号和单引号"><a href="#string-双引号和单引号" aria-hidden="true" class="header-anchor">#</a> string 双引号和单引号</h3><p>双引号表示<code>词组查询</code>，完全匹配该词组。例如：搜索<code>招商银行</code>， 可以搜出<code>招商证券</code>, 搜索<code>&quot;招商银行&quot;</code>，只能搜出<code>招商银行</code></p><h3 id="function-函数"><a href="#function-函数" aria-hidden="true" class="header-anchor">#</a> function 函数</h3><p>目前内建有以下函数</p><ul><li>currentUser() 搜索者</li><li>me() 搜索者, 等价于currentUser()</li><li>now() 当前时间</li><li>startOf(unit [[, offset], time]) 某个时间关于某个单位的开始, 可以设置偏移值, 亦可添加起算时间，例如: <code>startOf(d)</code>表达今天凌晨，<code>startOf(d, 8h)</code>表达今天8点. <code>startOf(month, 5d, -1month)</code>表达上月第5日凌晨</li><li>endOf(unit [, offset] [, time]) 某个时间关于某个单位的结束，例如: <code>endOf(d)</code> 今天晚上23:59:59:999.</li><li><s>offset(time, period) 某个时间的偏移，例如：<code>offset(now(), -7d)</code>表示距离现在7天前，等价于<code>-7d</code></s></li><li>tql(type, tqlString) 根据type和tql语句查询一组数据Id 用于<code>IN</code>和<code>NOT IN</code>操作，需要调用方实现方法</li><li>api(url, options...) 根据url查询一组数据Id 用于<code>IN</code>和<code>NOT IN</code>操作，需要调用方实现方法</li></ul><h3 id="groupexpr-聚合表达式"><a href="#groupexpr-聚合表达式" aria-hidden="true" class="header-anchor">#</a> groupExpr 聚合表达式</h3><p>GROUP [groupFn [DESC|ASC] [, ...]] BY groupAgg [, ...]</p><p>聚合函数，按照聚合分类进行聚合；聚合值必定包含数量，可以省略；聚合分类是一个<code>field</code>, 则可以按照聚合函数的值进行排序，排序方式紧跟函数后面，默认将以聚合分类的命中数量倒序排。例如：<code>GROUP SUM(storyPoint) DESC BY projectId</code></p><p>说明：未来将只支持一个聚合分类，不支持多个聚合分类。当聚合函数有多个的情况下，仅能按照第一个聚合函数的值进行排序。</p><h3 id="groupfn-聚合函数"><a href="#groupfn-聚合函数" aria-hidden="true" class="header-anchor">#</a> groupFn 聚合函数</h3><ul><li>COUNT() 计数函数, 可省略, 例如: <code>GROUP BY executorId</code> 等价于 <code>GROUP COUNT() BY executorId</code>, 即使不写COUNT函数，每一个桶结果还是会返回聚合数量</li><li>SUM(field) 求和函数</li><li>AVG(field) 求平均值函数</li><li>MAX(field) 求最大值函数</li><li>MIN(field) 求最小值函数</li></ul><h3 id="groupagg-聚合分类"><a href="#groupagg-聚合分类" aria-hidden="true" class="header-anchor">#</a> groupAgg 聚合分类</h3><ul><li>field 按字段聚合</li><li>DATE_HISTOGRAM(field, interval [, offset]) 按时间interval聚合，例如: <code>DATE_HISTOGRAM(created, month)</code> 按照自然月1月，2月进行聚合，注意，目前还不支持offset，所以所有时间均是UTC时间。</li><li>DATE 等价于 DATE_HISTOGRAM</li><li>HISTOGRAM(field, interval) 按数字字段的interval聚合, 例如: <code>HISTOGRAM(storyPoint, 1)</code></li><li><strong>NOT DONE</strong> FILTERS(conditionExpr [, ...]) 自定义聚合 未完成</li></ul><h3 id="orderexpr-排序表达式"><a href="#orderexpr-排序表达式" aria-hidden="true" class="header-anchor">#</a> orderExpr 排序表达式</h3><p>ORDER BY field [ASC|DESC] [, ...]</p><p>按某一个字段正序<code>ASC</code>或倒序<code>DESC</code>排序，默认按倒序排序。若没有排序表达式，默认按分数(_score)倒序，即<code>ORDER BY _score DESC</code></p><h2 id="已知缺陷"><a href="#已知缺陷" aria-hidden="true" class="header-anchor">#</a> 已知缺陷</h2><ul><li>中文输入法: 由于95%使用者是中文母语，中文母语的输入者都必须使用输入法，TQL部分内容有中英文混排，用户会有明显障碍。</li><li>全角／半角: 输入法存在全角半角，相同符号 例如<code>～</code>和<code>~</code>，对于用户很难辨识清楚自己使用的是全角还是半角。</li><li>字段名: 我们自身字段名的取名可能并非“表意”，甚至是有一些为了程序方便做的字段，用户用起来可能使用不便。</li><li>ObjectId: 我们在自定义字段和部分值中使用ObjectId，长达24位的ID对用户记忆和表达式的表意都不友好。</li></ul></div><!----><!----></div></div></div>
    <script src="/teambition-tql/assets/js/0.ca55fbad.js" defer></script><script src="/teambition-tql/assets/js/app.8630efd5.js" defer></script>
  </body>
</html>
